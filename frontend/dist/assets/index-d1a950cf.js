import{_ as j,u as B,r as _,f as O,i as n,j as q,o as G,q as E,w as l,k as a,l as H,a as g,e as J,A as r,z as f,p as W,d as $}from"./index-1aea0b7d.js";import{a as K}from"./article-d5f8adc5.js";const L=u=>(W("data-v-c047a8fb"),u=u(),$(),u),M=L(()=>g("h4",{style:{"text-align":"center",padding:"10px"}},"Release dynamic",-1)),Q={style:{margin:"16px"}},X={__name:"index",setup(u){const h=B(),b=()=>{h.push("/friendpage")},d=_(!1),x=()=>{d.value=!0},o=_({content:"",image:[],imageT:[],video:[]}),w=e=>{console.log("submit",e)},p=e=>e.size>=1e3*1024*50,y=e=>e.type.startsWith("video")?!0:(r("Please upload a video in the correct format"),!1),V=e=>/(jpg|jpeg|png|JPG|PNG)/i.test(e.type)?!0:(r("Please upload images in the correct format"),!1),m=O(),k=e=>{console.log(e),e.status="uploading",e.message="上传中...";let t=new FormData;t.append("file",e.file),f({url:window.location.origin+"/api/file/avatar/group",method:"POST",data:t,headers:{"content-type":"multipart/form-data",Authorization:"bearer "+m.token().value}}).then(i=>{i.data.code===200&&(e.status="done",r("success！"),o.value.imageT.push({url:i.data.data}),o.value.image=o.value.imageT)})},z=e=>{console.log(e),e.status="uploading",e.message="上传中...";let t=new FormData;t.append("file",e.file),f({url:window.location.origin+"/api/file/avatar/group",method:"POST",data:t,headers:{"content-type":"multipart/form-data",Authorization:"bearer "+m.token().value}}).then(i=>{i.data.code===200&&(e.status="done",r("success！"),o.value.video=[{url:i.data.data}])})},S=()=>{K.PublishArticle({content:o.value.content,image:o.value.image,video:o.value.video}).then(e=>{e.code===200?(d.value=!1,r("success！")):r(e.msg)})};return(e,t)=>{const i=n("van-icon"),F=n("van-nav-bar"),P=n("el-header"),D=n("van-cell"),T=n("van-list"),C=n("el-main"),c=n("van-field"),v=n("van-uploader"),R=n("van-button"),A=n("van-form"),I=n("van-popup"),N=n("el-container"),U=q("autofocus");return G(),E(N,{style:{"font-size":"large"}},{default:l(()=>[a(P,null,{default:l(()=>[a(F,{title:"Discover"},{right:l(()=>[a(i,{name:"add-o",size:"20","is-link":"",onClick:x})]),_:1})]),_:1}),a(C,null,{default:l(()=>[a(T,null,{default:l(()=>[a(D,{title:"Circle of friends",icon:"friends","is-link":"",to:"index",onClick:b,style:{color:"#FFFFFF","font-size":"large"}})]),_:1})]),_:1}),a(I,{show:d.value,"onUpdate:show":t[4]||(t[4]=s=>d.value=s),position:"bottom",style:{height:"40%"}},{default:l(()=>[M,a(A,{onSubmit:w},{default:l(()=>[H(a(c,{modelValue:o.value.content,"onUpdate:modelValue":t[0]||(t[0]=s=>o.value.content=s),name:"content",label:"content",placeholder:"content",rules:[{required:!0,message:"Please fill in the content"}]},null,8,["modelValue"]),[[U]]),a(c,{name:"uploader",label:"image"},{input:l(()=>[a(v,{modelValue:o.value.image,"onUpdate:modelValue":t[1]||(t[1]=s=>o.value.image=s),"max-size":p,"after-read":k,"before-read":V,"max-count":"3",multiple:""},null,8,["modelValue"])]),_:1}),a(c,{name:"uploader",label:"video"},{input:l(()=>[a(v,{modelValue:o.value.video,"onUpdate:modelValue":t[2]||(t[2]=s=>o.value.video=s),"max-size":p,"after-read":z,"before-read":y,reupload:"","max-count":"1",accept:"*"},null,8,["modelValue"])]),_:1}),g("div",Q,[a(R,{round:"",block:"",type:"primary","native-type":"submit",onClick:t[3]||(t[3]=s=>S())},{default:l(()=>[J(" Submit ")]),_:1})])]),_:1})]),_:1},8,["show"])]),_:1})}}},ee=j(X,[["__scopeId","data-v-c047a8fb"]]);export{ee as default};
