!function(){function e(e){return function(e){if(Array.isArray(e))return t(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,a){if(!e)return;if("string"==typeof e)return t(e,a);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return t(e,a)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}System.register(["./index-legacy-106e4135.js"],(function(t,a){"use strict";var n,o,r,l,u,i,c,d,s,f,v,p,m,g,h,y,b,x,_,k,w,F,j,z,S,A,C;return{setters:[function(e){n=e._,o=e.M,r=e.f,l=e.u,u=e.m,i=e.r,c=e.h,d=e.n,s=e.i,f=e.j,v=e.o,p=e.c,m=e.k,g=e.w,h=e.F,y=e.a,b=e.t,x=e.q,_=e.e,k=e.x,w=e.y,F=e.l,j=e.z,z=e.A,S=e.B,A=e.p,C=e.d}],execute:function(){var a=document.createElement("style");a.textContent="[data-v-29f90413] .van-cell{background:rgb(20,42,59);line-height:normal}[data-v-29f90413] .van-cell-group{background:transparent}.footer-icon[data-v-29f90413]{display:flex;justify-content:center;align-items:center}.el-footer[data-v-29f90413]{height:auto;padding:1vh 0}.chat-time[data-v-29f90413]{font-size:16px;color:#f0f0f0;line-height:17px;padding:30px 0;text-align:center}.other-content[data-v-29f90413]{display:flex;justify-content:flex-start;padding-bottom:2vh}.my-content[data-v-29f90413]{display:flex;justify-content:flex-end;padding-bottom:2vh}.my-talk-bubble[data-v-29f90413]{border-radius:10px 10px 0;overflow:visible;text-overflow:initial;white-space:normal;height:auto;background-color:var(--el-menu-active-color);max-width:80%}.other-talk-bubble[data-v-29f90413]{border-radius:10px 10px 10px 0;overflow:visible;text-overflow:initial;white-space:normal;height:auto;background-color:var(--el-menu-active-color);max-width:80%}.talktext[data-v-29f90413]{padding:1.5vh;line-height:2vh}.avatar-content[data-v-29f90413]{height:100%;width:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;gap:5px}.avatar-content .text[data-v-29f90413]{font-size:large;color:#fff;letter-spacing:.2vw}.van-icon[data-v-29f90413]{color:#fff;opacity:.5}.left-back[data-v-29f90413]{height:100%;width:100%;display:flex;justify-content:center;align-items:flex-start}.el-container[data-v-29f90413]{height:100%;background-color:#142a3b!important}.el-header[data-v-29f90413]{height:auto;padding:2vh 0;border-bottom:1px solid rgba(255,255,255,.1)}.el-main[data-v-29f90413]{border-bottom:1px solid rgba(255,255,255,.1)}img[data-v-29f90413]{height:10vh;width:10vh;border-radius:50%}[data-v-29f90413] .van-field__control{color:#fff}\n",document.head.appendChild(a);var M={class:"avatar-content"},I=["src"],P={style:{display:"flex","align-items":"center","justify-content":"space-between",width:"100%"}},T={class:"text"},U={class:"chat-time"},V={key:0,class:"other-content"},O={style:{display:"flex","flex-direction":"column"}},B={style:{color:"#FFFFFF"}},D=["src"],G={key:0,class:"my-talk-bubble"},R={class:"talktext"},E=["src"],$={key:2,controls:""},q=["src"],J={key:1,class:"my-content"},N={key:0,class:"my-talk-bubble"},Y={class:"talktext"},H=["src"],K={key:2,controls:""},L=["src"],Q={style:{display:"flex","flex-direction":"column"}},W={style:{color:"#FFFFFF"}},X=["src"],Z=function(e){return A("data-v-29f90413"),e=e(),C(),e}((function(){return y("h4",{style:{"text-align":"center",padding:"10px"}},"Send pictures",-1)})),ee={style:{margin:"16px"}},te={__name:"index",setup:function(t){var a=o.getInstance().socket,n=r();l();var A=u(),C=i({}),te=i([n.user().value.id,A.params.id].sort().join("_")),ae=i({content:"",recipient_id:"",image_url:"",audio_url:"",token:n.token().value,room:te.value}),ne=i(null),oe=i([]),re=function(){navigator.mediaDevices.getUserMedia({audio:!0}).then((function(e){ne.value=new MediaRecorder(e),oe.value=[],ne.value.ondataavailable=function(e){e.data.size>0&&oe.value.push(e.data)},ne.value.start()})).catch((function(e){console.error("Recording failed:",e)}))},le=function(){ne.value&&"inactive"!==ne.value.state&&(ne.value.stop(),ne.value.onstop=function(){var e=new Blob(oe.value,{type:"audio/mp3"});ue(e)})},ue=function(e){var t=new FormData;t.append("audio",e,"audio.mp3"),j(window.location.origin+"/api/file/audio",{method:"POST",data:t,headers:{Authorization:"bearer "+n.token().value}}).then((function(e){200===e.data.code&&(console.log(e.data.data),ae.value.audio_url=e.data.data,ce())})).catch((function(e){console.error("Sending audio failed:",e)}))},ie=i(n.group(te.value));c((function(){d.GetUserInfoById({id:A.params.id}).then((function(e){200===e.code&&(C.value=e.data)})),n.joined_user(n.user().value.id,A.params.id),a.on("joined_user_message",(function(e){ie.value=e.message,n.group(te.value).value=e.message}))})),a.on("user_message",(function(t){console.log(t);var a=[].concat(e(ie.value),[t.message]);ie.value=a,n.group(te.value).value=ie.value}));var ce=function(){""===ae.value.image_url&&""===ae.value.audio_url&&""===ae.value.content||(ae.value.recipient_id=C.value.id,a.emit("privateChat",ae.value),ae.value.content="",ae.value.image_url="",ae.value.audio_url="",me.value=!1,de.value=[],console.log(ae.value))},de=i([]),se=function(e){var t="image/jpeg"===e.type?512e3:1024e3;return e.size>=t},fe=function(e){return!!/(jpg|jpeg|png|JPG|PNG)/i.test(e.type)||(z("Please upload images in the correct format"),!1)},ve=function(e){console.log("submit",e)},pe=function(e){e.status="uploading",e.message="上传中...";var t=new FormData;t.append("file",e.file),j({url:window.location.origin+"/api/file/avatar/group",method:"POST",data:t,headers:{"content-type":"multipart/form-data",Authorization:"bearer "+n.token().value}}).then((function(t){200===t.data.code&&(e.status="done",z("success！"),ae.value.image_url=t.data.data,de.value=[{url:t.data.data}])}))},me=i(!1);return function(e,t){var a=s("van-icon"),o=s("el-col"),r=s("van-tag"),l=s("el-row"),u=s("el-header"),i=s("el-main"),c=s("Microphone"),d=s("el-icon"),j=s("Picture"),z=s("Right"),A=s("van-field"),te=s("van-cell-group"),ne=s("el-footer"),oe=s("el-container"),ue=s("van-uploader"),ge=s("van-button"),he=s("van-form"),ye=s("van-popup"),be=f("autofocus");return v(),p(h,null,[m(oe,null,{default:g((function(){return[m(u,null,{default:g((function(){return[m(l,{gutter:12},{default:g((function(){return[m(o,{span:4},{default:g((function(){return[y("div",{class:"left-back",onClick:t[0]||(t[0]=function(t){return e.$router.back()})},[m(a,{name:"arrow-left",size:"20"})])]})),_:1}),m(o,{span:16},{default:g((function(){return[y("div",M,[y("img",{src:C.value.avatar,alt:""},null,8,I),y("div",P,[y("span",T,b(C.value.username),1),y("span",null,[1===C.value.online?(v(),x(r,{key:0,type:"success"},{default:g((function(){return[_("online")]})),_:1})):k("",!0),0===C.value.online?(v(),x(r,{key:1,type:"danger"},{default:g((function(){return[_("offline")]})),_:1})):k("",!0),2===C.value.online?(v(),x(r,{key:2,type:"warning"},{default:g((function(){return[_("busy")]})),_:1})):k("",!0)])])])]})),_:1})]})),_:1})]})),_:1}),m(i,null,{default:g((function(){return[(v(!0),p(h,null,w(ie.value,(function(e,t){return v(),p("div",{key:t},[y("div",U,b(e.created_at),1),e.sender.id!==S(n).user().value.id?(v(),p("div",V,[y("div",O,[y("span",B,b(e.sender.username),1),y("img",{src:e.sender.avatar,alt:"",style:{width:"50px",height:"50px","margin-left":"10px"}},null,8,D)]),e.content?(v(),p("div",G,[y("div",R,[y("p",null,b(e.content),1)])])):e.image_url?(v(),p("img",{key:1,src:e.image_url,alt:"",style:{"border-radius":"0"}},null,8,E)):e.audio_url?(v(),p("audio",$,[y("source",{src:e.audio_url,type:"audio/mp3"},null,8,q)])):k("",!0)])):k("",!0),e.sender.id===S(n).user().value.id?(v(),p("div",J,[e.content?(v(),p("div",N,[y("div",Y,[y("p",null,b(e.content),1)])])):e.image_url?(v(),p("img",{key:1,src:e.image_url,alt:"",style:{"border-radius":"0"}},null,8,H)):e.audio_url?(v(),p("audio",K,[y("source",{src:e.audio_url,type:"audio/mp3"},null,8,L)])):k("",!0),y("div",Q,[y("span",W,b(e.sender.username),1),y("img",{src:e.sender.avatar,alt:"",style:{width:"50px",height:"50px","margin-left":"10px"}},null,8,X)])])):k("",!0)])})),128))]})),_:1}),m(ne,null,{default:g((function(){return[m(te,{inset:""},{default:g((function(){return[F((v(),x(A,{modelValue:ae.value.content,"onUpdate:modelValue":t[3]||(t[3]=function(e){return ae.value.content=e}),placeholder:"Send Your Message"},{"left-icon":g((function(){return[m(d,{size:"25",color:"#FFFFFF",onMousedown:re,onMouseup:le,onTouchstart:re,onTouchmove:le,onTouchend:le},{default:g((function(){return[m(c)]})),_:1}),m(d,{size:"25",color:"#FFFFFF",onClick:t[1]||(t[1]=function(e){me.value=!0}),style:{"margin-left":"20px"}},{default:g((function(){return[m(j)]})),_:1})]})),"right-icon":g((function(){return[m(d,{size:"25",color:"#FFFFFF",onClick:t[2]||(t[2]=function(e){return ce()})},{default:g((function(){return[m(z)]})),_:1})]})),_:1},8,["modelValue"])),[[be]])]})),_:1})]})),_:1})]})),_:1}),m(ye,{show:me.value,"onUpdate:show":t[6]||(t[6]=function(e){return me.value=e}),position:"bottom",style:{height:"35%"}},{default:g((function(){return[Z,m(he,{onSubmit:ve},{default:g((function(){return[m(A,{name:"uploader",label:"avatar"},{input:g((function(){return[m(ue,{modelValue:de.value,"onUpdate:modelValue":t[4]||(t[4]=function(e){return de.value=e}),"max-size":se,"after-read":pe,"before-read":fe,reupload:"","max-count":"1"},null,8,["modelValue"])]})),_:1}),y("div",ee,[m(ge,{round:"",block:"",type:"primary","native-type":"submit",onClick:t[5]||(t[5]=function(e){return ce()})},{default:g((function(){return[_(" submit ")]})),_:1})])]})),_:1})]})),_:1},8,["show"])],64)}}};t("default",n(te,[["__scopeId","data-v-29f90413"]]))}}}))}();
