import{_ as z,M as D,f as E,r as _,u as G,i as l,o as a,q as f,w as t,k as s,B as j,c as r,y as T,F as A,a as n,t as c,x as B}from"./index-1aea0b7d.js";import"./moment-f267b416.js";const H=["src"],J={class:"text-content"},K={style:{width:"100%",display:"flex","justify-content":"space-between","align-items":"center"}},O={class:"text"},P={key:0},Q={key:1},W={key:1},X=["src"],Y={class:"text-content"},Z={style:{width:"100%",display:"flex","justify-content":"space-between","align-items":"center"}},ee={key:0,class:"text"},ne={key:1,class:"text"},te=["src"],se={class:"text-content"},ae={style:{width:"100%",display:"flex","justify-content":"space-between","align-items":"center"}},oe={class:"text"},le={__name:"index",setup(ce){const{socket:k}=D.getInstance(),i=E(),V=_([]),p=_(!1),h=_(!1),v=_(!1),y=G(),x=_(i.histories(i.user().value.number).value);i.joined_history();const C=()=>{setTimeout(()=>{v.value&&(V.value=[],v.value=!1),k.emit("history",{token:i.token().value}),k.on("history_message",o=>{console.log(o),x.value=o.history,i.histories(i.user().value.number).value=o.history}),p.value=!1,h.value=!0},1e3)},$=()=>{h.value=!1,p.value=!0,C()},w=o=>{console.log(o),y.push("/index/".concat(o))},L=o=>{console.log(o),y.push("/group/".concat(o))};return(o,d)=>{const M=l("van-icon"),N=l("van-nav-bar"),R=l("el-header"),u=l("van-col"),g=l("van-row"),m=l("van-cell"),S=l("van-list"),F=l("van-pull-refresh"),I=l("el-main"),U=l("el-container");return a(),f(U,null,{default:t(()=>[s(R,null,{default:t(()=>[s(N,{title:"Message"},{right:t(()=>[s(M,{name:"map-marked",size:"20","is-link":"",onClick:d[0]||(d[0]=e=>j(y).push({name:"Bottle"}))})]),_:1})]),_:1}),s(I,null,{default:t(()=>[s(F,{modelValue:v.value,"onUpdate:modelValue":d[2]||(d[2]=e=>v.value=e),onRefresh:$},{default:t(()=>[s(S,{loading:p.value,"onUpdate:loading":d[1]||(d[1]=e=>p.value=e),finished:h.value,onLoad:C},{default:t(()=>[(a(!0),r(A,null,T(x.value,(e,q)=>(a(),r("div",{key:q},[e.group?(a(),f(m,{key:0,onClick:b=>L(e.group.id)},{default:t(()=>[s(g,{gutter:"10"},{default:t(()=>[s(u,{span:"6",style:{display:"flex","align-items":"center","justify-content":"center"}},{default:t(()=>[n("img",{src:e.group.avatar,alt:""},null,8,H)]),_:2},1024),s(u,{span:"18"},{default:t(()=>[n("div",J,[n("div",K,[n("span",O,c(e.group.name),1),n("span",null,c(e.updated_at),1)]),n("div",null,[e.message?(a(),r("span",P,c(e.message),1)):(a(),r("span",Q,"media"))])])]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])):B("",!0),e.sender?(a(),r("div",W,[e.sender.id===j(i).user().value.id?(a(),f(m,{key:0},{default:t(()=>[s(g,{gutter:"10",onClick:b=>w(e.recipient.id)},{default:t(()=>[s(u,{span:"6",style:{display:"flex","align-items":"center","justify-content":"center"}},{default:t(()=>[n("img",{src:e.recipient.avatar,alt:""},null,8,X)]),_:2},1024),s(u,{span:"18"},{default:t(()=>[n("div",Y,[n("div",Z,[e.sender.id===e.recipient.id?(a(),r("span",ee,"myself")):(a(),r("span",ne,c(e.recipient.username),1)),n("span",null,c(e.updated_at),1)]),n("div",null,[n("span",null,c(e.message),1)])])]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024)):(a(),f(m,{key:1},{default:t(()=>[s(g,{gutter:"10",onClick:b=>w(e.sender.id)},{default:t(()=>[s(u,{span:"6",style:{display:"flex","align-items":"center","justify-content":"center"}},{default:t(()=>[n("img",{src:e.sender.avatar,alt:""},null,8,te)]),_:2},1024),s(u,{span:"18"},{default:t(()=>[n("div",se,[n("div",ae,[n("span",oe,c(e.sender.username),1),n("span",null,c(e.updated_at),1)]),n("div",null,[n("span",null,c(e.message),1)])])]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024))])):B("",!0)]))),128))]),_:1},8,["loading","finished"])]),_:1},8,["modelValue"])]),_:1})]),_:1})}}},de=z(le,[["__scopeId","data-v-a9e8e465"]]);export{de as default};
