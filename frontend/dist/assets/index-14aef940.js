import{_ as ue,f as ce,u as pe,r as f,h as _e,D as me,i as r,o as i,q as p,w as l,k as a,c,y as S,F as z,a as s,e as k,B as I,x as T,E as ve,C as F,A as L,z as q,t as g,p as fe,d as ge}from"./index-1aea0b7d.js";import{a as v}from"./article-d5f8adc5.js";import"./moment-f267b416.js";const $=w=>(fe("data-v-befcd916"),w=w(),ge(),w),he={style:{display:"flex","flex-direction":"column","justify-content":"flex-start","align-items":"center"}},ye=["src"],xe={class:"card-header"},be={style:{color:"#fafafa","font-size":"18px","font-weight":"bold","margin-bottom":"10px",display:"block"}},ke={key:0,class:"img-content",style:{"margin-bottom":"20px"}},we={key:0},Ce={key:1,style:{display:"grid",gap:"10px","grid-template-columns":"repeat(3, 1fr)"}},Ae={key:1},Ve={controls:"",style:{width:"300px"}},De=["src"],Se={style:{"margin-top":"10px",display:"flex","align-items":"center","justify-content":"space-between"}},ze={style:{"background-color":"#f7f7f7","border-radius":"5px",padding:"2px 10px 5px 10px","margin-top":"10px"}},Te={style:{color:"#576b95","font-size":"12px"}},Fe={style:{margin:"10px 0"}},Le={style:{color:"#576b95","font-size":"12px"}},Pe={style:{"font-size":"12px",color:"#000000","margin-left":"5px","overflow-wrap":"break-word"}},$e=$(()=>s("div",{style:{width:"100%","border-bottom":"#FFFFFF solid 1px",margin:"20px 0"}},null,-1)),Ue=$(()=>s("h4",{style:{"text-align":"center",padding:"10px"}},"Modify Dynamics",-1)),Ee={style:{margin:"16px"}},Oe={key:0,style:{display:"flex","align-items":"center","justify-content":"flex-start",padding:"10px"}},je=$(()=>s("h4",{style:{"text-align":"center",padding:"10px"}},"Send comments",-1)),Be={style:{margin:"16px"}},Ne={__name:"index",setup(w){const h=ce(),G=pe(),U=f([]),M=()=>G.back(),_=()=>{v.GetMyArticle({}).then(e=>{e.data.articles.forEach(t=>{t.image_url&&t.image_url.indexOf(";")!==-1&&(t.image_url=t.image_url.split(";"))}),U.value=e.data.articles})};_e(()=>{_()});const J=e=>{ve({title:"Delete",message:"Are you sure to delete"}).then(()=>{v.DeleteArticle({id:e}).then(t=>{t.code===200&&(F(t.msg),_())})}).catch(()=>{})},n=f({id:"",content:"",image:[],imageT:[],video:[]}),y=f(!1),W=e=>{if(n.value.content=e.content,n.value.id=e.id,typeof e.image_url=="string")n.value.image=[{url:e.image_url}],n.value.imageT=[{url:e.image_url}];else for(let t=0;t<e.image_url.length;t++)n.value.image.push({url:e.image_url[t]}),n.value.imageT.push({url:e.image_url[t]});e.video_url?n.value.video=[{url:e.video_url}]:n.value.video=[],y.value=!0},E=e=>{console.log("submit",e)},O=e=>e.size>=1e3*1024*5,H=e=>e.type.startsWith("video")?!0:(L("Please upload a video in the correct format"),!1),K=e=>/(jpg|jpeg|png|JPG|PNG)/i.test(e.type)?!0:(L("Please upload images in the correct format"),!1),Q=e=>{e.status="uploading",e.message="上传中...";let t=new FormData;t.append("file",e.file),q({url:window.location.origin+"/api/file/avatar/group",method:"POST",data:t,headers:{"content-type":"multipart/form-data",Authorization:"bearer "+h.token().value}}).then(d=>{d.data.code===200&&(e.status="done",F(d.data.msg),n.value.imageT.push({url:d.data.data}),n.value.image=n.value.imageT,n.value.imageT=[])})},X=e=>{e.status="uploading",e.message="上传中...";let t=new FormData;t.append("file",e.file),q({url:window.location.origin+"/api/file/avatar/group",method:"POST",data:t,headers:{"content-type":"multipart/form-data",Authorization:"bearer "+h.token().value}}).then(d=>{d.data.code===200&&(e.status="done",F(d.data.msg),n.value.video=[{url:d.data.data}])})},Y=()=>{v.UpdateArticle({id:n.value.id,content:n.value.content,image:n.value.image,video:n.value.video}).then(e=>{e.code===200&&(y.value=!1,F(e.msg),_(),n.value.image=[])})},Z=e=>e.length===0?!0:e.like.map(d=>d.user.id).indexOf(h.user().value.id)===-1,ee=e=>{v.ArticleLike({id:e.id}).then(t=>{t.code===200&&_()})},te=e=>{v.ArticleDisLike({id:e.id}).then(t=>{t.code===200&&_()})},x=f({}),C=f(!1),oe=e=>{x.value=e,C.value=!0},b=f({content:"",article_id:""}),ae=e=>{b.value.article_id=e,v.ArticleComment(b.value).then(t=>{t.code===200?(_(),C.value=!1,b.value={}):L(t.msg)})},ne=e=>{v.ArticleCommentDel({id:e}).then(t=>{t.code===200?_():L(t.msg)})};return me(y,(e,t)=>{e===!1&&(n.value.image=[])}),(e,t)=>{const d=r("van-nav-bar"),le=r("el-header"),m=r("el-col"),j=r("el-image"),A=r("van-icon"),P=r("el-row"),se=r("el-card"),ie=r("van-back-top"),re=r("el-main"),V=r("van-field"),B=r("van-uploader"),D=r("van-button"),N=r("van-form"),R=r("van-popup"),de=r("el-container");return i(),p(de,null,{default:l(()=>[a(le,null,{default:l(()=>[a(d,{title:"Circle of friends","left-arrow":"",onClickLeft:M})]),_:1}),a(re,null,{default:l(()=>[(i(!0),c(z,null,S(U.value,o=>(i(),p(P,{gutter:15},{default:l(()=>[a(m,{span:3},{default:l(()=>[s("div",he,[s("img",{src:o.user.avatar,alt:"",style:{width:"40px",height:"40px"}},null,8,ye)])]),_:2},1024),a(m,{span:21},{default:l(()=>[a(se,{class:"box-card"},{header:l(()=>[s("div",xe,[s("span",be,g(o.user.username),1),s("span",null,g(o.content),1)])]),default:l(()=>[o.image_url?(i(),c("div",ke,[typeof o.image_url=="string"?(i(),c("div",we,[a(j,{style:{width:"10vh",height:"10vh"},src:o.image_url,fit:"cover"},null,8,["src"])])):(i(),c("div",Ce,[(i(!0),c(z,null,S(o.image_url,u=>(i(),p(j,{style:{width:"10vh",height:"10vh"},src:u,fit:"cover"},null,8,["src"]))),256))]))])):T("",!0),o.video_url?(i(),c("div",Ae,[s("video",Ve,[s("source",{src:o.video_url,type:"video/mp4",style:{width:"100%",height:"100%"}},null,8,De)])])):T("",!0),s("div",Se,[k(g(o.created_at)+" ",1),a(A,{name:"ellipsis",onClick:u=>oe(o),style:{"background-color":"#dedede",color:"#4e6086","border-radius":"5px",padding:"2px 4px"}},null,8,["onClick"])]),s("div",ze,[a(P,{gutter:15},{default:l(()=>[a(m,{span:2},{default:l(()=>[Z(o)?(i(),p(A,{key:0,name:"like-o",onClick:u=>ee(o),color:"#576b95"},null,8,["onClick"])):(i(),p(A,{key:1,name:"like",onClick:u=>te(o),color:"#576b95"},null,8,["onClick"]))]),_:2},1024),(i(!0),c(z,null,S(o.like,u=>(i(),p(m,{span:6},{default:l(()=>[s("span",Te,g(u.user.username)+"、",1)]),_:2},1024))),256))]),_:2},1024),s("div",Fe,[(i(!0),c(z,null,S(o.comment,u=>(i(),p(P,{gutter:30},{default:l(()=>[a(m,{span:4},{default:l(()=>[s("span",Le,g(u.user.username)+"：",1)]),_:2},1024),a(m,{span:16},{default:l(()=>[s("span",Pe,g(u.content),1)]),_:2},1024),a(m,{span:2},{default:l(()=>[u.user.id===I(h).user().value.id?(i(),p(A,{key:0,name:"delete-o",onClick:Re=>ne(u.id),color:"#000000"},null,8,["onClick"])):T("",!0)]),_:2},1024)]),_:2},1024))),256))])])]),_:2},1024)]),_:2},1024),$e]),_:2},1024))),256)),a(ie)]),_:1}),a(R,{show:y.value,"onUpdate:show":t[4]||(t[4]=o=>y.value=o),position:"bottom",style:{height:"40%"}},{default:l(()=>[Ue,a(N,{onSubmit:E},{default:l(()=>[a(V,{modelValue:n.value.content,"onUpdate:modelValue":t[0]||(t[0]=o=>n.value.content=o),name:"content",label:"内容",placeholder:"content",rules:[{required:!0,message:" Please fill in the content "}]},null,8,["modelValue"]),a(V,{name:"uploader",label:"image"},{input:l(()=>[a(B,{modelValue:n.value.image,"onUpdate:modelValue":t[1]||(t[1]=o=>n.value.image=o),"max-size":O,"after-read":Q,"before-read":K,"max-count":"3",multiple:""},null,8,["modelValue"])]),_:1}),a(V,{name:"uploader",label:"video"},{input:l(()=>[a(B,{modelValue:n.value.video,"onUpdate:modelValue":t[2]||(t[2]=o=>n.value.video=o),"max-size":O,"after-read":X,"before-read":H,reupload:"","max-count":"1",accept:"*"},null,8,["modelValue"])]),_:1}),s("div",Ee,[a(D,{round:"",block:"",type:"primary","native-type":"submit",onClick:t[3]||(t[3]=o=>Y())},{default:l(()=>[k(" submit ")]),_:1})])]),_:1})]),_:1},8,["show"]),a(R,{show:C.value,"onUpdate:show":t[9]||(t[9]=o=>C.value=o),position:"bottom",style:{height:"40%"}},{default:l(()=>[x.value.user.id===I(h).user().value.id?(i(),c("div",Oe,[a(D,{type:"primary",onClick:t[5]||(t[5]=o=>W(x.value)),style:{"margin-right":"10px"}},{default:l(()=>[k("modify")]),_:1}),a(D,{type:"danger",onClick:t[6]||(t[6]=o=>J(x.value.id))},{default:l(()=>[k("delete")]),_:1})])):T("",!0),je,a(N,{onSubmit:E},{default:l(()=>[a(V,{modelValue:b.value.content,"onUpdate:modelValue":t[7]||(t[7]=o=>b.value.content=o),name:"content",label:"content",placeholder:"content",rules:[{required:!0,message:"Please fill in the content"}]},null,8,["modelValue"]),s("div",Be,[a(D,{round:"",block:"",type:"primary","native-type":"submit",onClick:t[8]||(t[8]=o=>ae(x.value.id))},{default:l(()=>[k(" submit ")]),_:1})])]),_:1})]),_:1},8,["show"])]),_:1})}}},Me=ue(Ne,[["__scopeId","data-v-befcd916"]]);export{Me as default};
