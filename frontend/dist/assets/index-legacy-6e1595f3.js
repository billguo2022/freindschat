!function(){function e(e){return function(e){if(Array.isArray(e))return t(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,n){if(!e)return;if("string"==typeof e)return t(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return t(e,n)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}System.register(["./index-legacy-106e4135.js","./group-legacy-77afdbf4.js"],(function(t,n){"use strict";var a,r,o,l,u,i,c,d,s,f,v,p,g,m,b,h,y,x,_,k,w,F,j,z,S,A,C,M;return{setters:[function(e){a=e._,r=e.r,o=e.M,l=e.f,u=e.u,i=e.m,c=e.h,d=e.i,s=e.j,f=e.o,v=e.c,p=e.k,g=e.w,m=e.F,b=e.a,h=e.t,y=e.y,x=e.l,_=e.q,k=e.e,w=e.z,F=e.A,j=e.C,z=e.B,S=e.x,A=e.p,C=e.d},function(e){M=e.g}],execute:function(){var n=document.createElement("style");n.textContent="[data-v-bfc950b6] .van-cell{background:rgb(20,42,59);line-height:normal}[data-v-bfc950b6] .van-cell-group{background:transparent}.footer-icon[data-v-bfc950b6]{display:flex;justify-content:center;align-items:center}.el-footer[data-v-bfc950b6]{height:auto;padding:1vh 0}.chat-time[data-v-bfc950b6]{font-size:16px;color:#f0f0f0;line-height:17px;padding:30px 0;text-align:center}.other-content[data-v-bfc950b6]{display:flex;justify-content:flex-start;padding-bottom:2vh}.my-content[data-v-bfc950b6]{display:flex;justify-content:flex-end;padding-bottom:2vh}.my-talk-bubble[data-v-bfc950b6]{border-radius:10px 10px 0;overflow:visible;text-overflow:initial;white-space:normal;height:auto;background-color:var(--el-menu-active-color);max-width:80%}.other-talk-bubble[data-v-bfc950b6]{border-radius:10px 10px 10px 0;overflow:visible;text-overflow:initial;white-space:normal;height:auto;background-color:var(--el-menu-active-color);max-width:80%}.talktext[data-v-bfc950b6]{padding:1.5vh;line-height:2vh}.avatar-content[data-v-bfc950b6]{height:100%;width:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;gap:5px}.avatar-content .text[data-v-bfc950b6]{font-size:large;color:#fff;letter-spacing:.2vw;margin:0 10px}.van-icon[data-v-bfc950b6]{color:#fff;opacity:.5}.left-back[data-v-bfc950b6]{height:100%;width:100%;display:flex;justify-content:center;align-items:flex-start}.el-container[data-v-bfc950b6]{height:100%;background-color:#142a3b!important}.el-header[data-v-bfc950b6]{height:auto;padding:2vh 0;border-bottom:1px solid rgba(255,255,255,.1)}.el-main[data-v-bfc950b6]{border-bottom:1px solid rgba(255,255,255,.1)}img[data-v-bfc950b6]{height:10vh;width:10vh;border-radius:50%}[data-v-bfc950b6] .van-field__control{color:#fff}\n",document.head.appendChild(n);var U=function(e){return A("data-v-bfc950b6"),e=e(),C(),e},I={class:"avatar-content"},P=["src"],T={style:{display:"flex","align-items":"center",width:"100%","justify-content":"center"}},V={class:"text",style:{"text-align":"center"}},G={class:"chat-time"},O={key:0,class:"other-content"},B={style:{display:"flex","flex-direction":"column"}},D={style:{color:"#FFFFFF"}},R=["src"],E={key:0,class:"my-talk-bubble"},N={class:"talktext"},$=["src"],q={key:2,controls:""},J=["src"],Y={key:1,class:"my-content"},H={key:0,class:"my-talk-bubble"},K={class:"talktext"},L=["src"],Q={key:2,controls:""},W=["src"],X={style:{display:"flex","flex-direction":"column"}},Z={style:{color:"#FFFFFF"}},ee=["src"],te=U((function(){return b("h4",{style:{"text-align":"center",padding:"10px"}},"Group chat personnel",-1)})),ne=["src"],ae={style:{height:"100%",display:"flex","justify-content":"flex-start","align-items":"flex-start"}},re={class:"text",style:{"margin-right":"10px"}},oe={class:"text",style:{"margin-right":"10px"}},le={key:0,class:"text",style:{"margin-right":"10px"}},ue=U((function(){return b("h4",{style:{"text-align":"center",padding:"10px"}},"Send pictures",-1)})),ie={style:{margin:"16px"}},ce={__name:"index",setup:function(t){r(null);var n=o.getInstance().socket,a=l();u();var A=i(),C=r({}),U=r(a.group(A.params.id).value);r(null);var ce=r({content:"",group_id:A.params.id,image_url:"",audio_url:"",token:a.token().value}),de=r(null),se=r([]),fe=function(){navigator.mediaDevices.getUserMedia({audio:!0}).then((function(e){de.value=new MediaRecorder(e),se.value=[],de.value.ondataavailable=function(e){e.data.size>0&&se.value.push(e.data)},de.value.start()})).catch((function(e){console.error("Recording failed:",e)}))},ve=function(){de.value&&"inactive"!==de.value.state&&(de.value.stop(),de.value.onstop=function(){var e=new Blob(se.value,{type:"audio/mp3"});pe(e)})},pe=function(e){var t=new FormData;t.append("audio",e,"audio.mp3"),w(window.location.origin+"/api/file/audio",{method:"POST",data:t,headers:{Authorization:"bearer "+a.token().value}}).then((function(e){200===e.data.code&&(console.log(e.data.data),ce.value.audio_url=e.data.data,ge())})).catch((function(e){console.error("发送音频失败:",e)}))};c((function(){M.GetGroupById({id:A.params.id}).then((function(e){200===e.code&&(C.value=e.data)})),a.joined_group(A.params.id),n.on("joined_group_message",(function(e){console.log("joined_group_message"),U.value=e.message,a.group(A.params.id).value=e.message}))}));var ge=function(){""===ce.value.image_url&&""===ce.value.audio_url&&""===ce.value.content||(n.emit("groupChat",ce.value),ce.value.content="",ce.value.image_url="",ce.value.audio_url="",je.value=!1,xe.value=[])};n.on("group_message",(function(t){console.log(t);var n=[].concat(e(U.value),[t.message]);U.value=n,a.group(A.params.id).value=U.value}));var me=r([]),be=r(!1),he=r(!1);r(!1);var ye=r(!1),xe=r([]),_e=function(e){var t="image/jpeg"===e.type?512e3:1024e3;return e.size>=t},ke=function(e){return!!/(jpg|jpeg|png|JPG|PNG)/i.test(e.type)||(F("Please upload images in the correct format"),!1)},we=function(e){console.log("submit",e)},Fe=function(e){e.status="uploading",e.message="上传中...";var t=new FormData;t.append("file",e.file),w({url:window.location.origin+"/api/file/avatar/group",method:"POST",data:t,headers:{"content-type":"multipart/form-data",Authorization:"bearer "+a.token().value}}).then((function(t){200===t.data.code&&(e.status="done",j(t.data.msg),ce.value.image_url=t.data.data,xe.value=[{url:t.data.data}])}))},je=r(!1);return function(e,t){var n=d("van-icon"),r=d("el-col"),o=d("el-row"),l=d("el-header"),u=d("el-main"),i=d("Microphone"),c=d("el-icon"),w=d("Picture"),F=d("Right"),j=d("van-field"),A=d("van-cell-group"),M=d("el-footer"),de=d("el-container"),se=d("van-col"),pe=d("van-tag"),ze=d("van-row"),Se=d("van-cell"),Ae=d("van-list"),Ce=d("van-popup"),Me=d("van-uploader"),Ue=d("van-button"),Ie=d("van-form"),Pe=s("autofocus");return f(),v(m,null,[p(de,null,{default:g((function(){return[p(l,null,{default:g((function(){return[p(o,{gutter:12},{default:g((function(){return[p(r,{span:4},{default:g((function(){return[b("div",{class:"left-back",onClick:t[0]||(t[0]=function(t){return e.$router.back()})},[p(n,{name:"arrow-left",size:"20"})])]})),_:1}),p(r,{span:16},{default:g((function(){return[b("div",I,[b("img",{src:C.value.avatar,alt:""},null,8,P),b("div",T,[b("span",V,h(C.value.name),1)])])]})),_:1}),p(r,{span:4},{default:g((function(){return[b("div",{class:"left-back",onClick:t[1]||(t[1]=function(e){return ye.value=!0,me.value=C.value.members,be.value=!0,void(he.value=!0)})},[p(n,{name:"friends-o",size:"20"})])]})),_:1})]})),_:1})]})),_:1}),p(u,null,{default:g((function(){return[(f(!0),v(m,null,y(U.value,(function(e,t){return f(),v("div",{key:t},[b("div",G,h(e.created_at),1),e.sender.id!==z(a).user().value.id?(f(),v("div",O,[b("div",B,[b("span",D,h(e.sender.username),1),b("img",{src:e.sender.avatar,alt:"",style:{width:"50px",height:"50px","margin-left":"10px"}},null,8,R)]),e.content?(f(),v("div",E,[b("div",N,[b("p",null,h(e.content),1)])])):e.image_url?(f(),v("img",{key:1,src:e.image_url,alt:"",style:{"border-radius":"0"}},null,8,$)):e.audio_url?(f(),v("audio",q,[b("source",{src:e.audio_url,type:"audio/mp3"},null,8,J)])):S("",!0)])):S("",!0),e.sender.id===z(a).user().value.id?(f(),v("div",Y,[e.content?(f(),v("div",H,[b("div",K,[b("p",null,h(e.content),1)])])):e.image_url?(f(),v("img",{key:1,src:e.image_url,alt:"",style:{"border-radius":"0"}},null,8,L)):e.audio_url?(f(),v("audio",Q,[b("source",{src:e.audio_url,type:"audio/mp3"},null,8,W)])):S("",!0),b("div",X,[b("span",Z,h(e.sender.username),1),b("img",{src:e.sender.avatar,alt:"",style:{width:"50px",height:"50px","margin-left":"10px"}},null,8,ee)])])):S("",!0)])})),128))]})),_:1}),p(M,null,{default:g((function(){return[p(A,{inset:""},{default:g((function(){return[x((f(),_(j,{modelValue:ce.value.content,"onUpdate:modelValue":t[4]||(t[4]=function(e){return ce.value.content=e}),placeholder:"Send Your Message"},{"left-icon":g((function(){return[p(c,{size:"25",color:"#FFFFFF",onMousedown:fe,onMouseup:ve,onTouchstart:fe,onTouchmove:ve,onTouchend:ve},{default:g((function(){return[p(i)]})),_:1}),p(c,{size:"25",color:"#FFFFFF",onClick:t[2]||(t[2]=function(e){je.value=!0}),style:{"margin-left":"20px"}},{default:g((function(){return[p(w)]})),_:1})]})),"right-icon":g((function(){return[p(c,{size:"25",color:"#FFFFFF",onClick:t[3]||(t[3]=function(e){return ge()})},{default:g((function(){return[p(F)]})),_:1})]})),_:1},8,["modelValue"])),[[Pe]])]})),_:1})]})),_:1})]})),_:1}),p(Ce,{show:ye.value,"onUpdate:show":t[6]||(t[6]=function(e){return ye.value=e}),position:"bottom",style:{height:"50%"}},{default:g((function(){return[te,p(Ae,{loading:be.value,"onUpdate:loading":t[5]||(t[5]=function(e){return be.value=e}),finished:he.value,"finished-text":"No more..."},{default:g((function(){return[(f(!0),v(m,null,y(me.value,(function(e,t){return f(),_(Se,{key:t},{default:g((function(){return[p(ze,{gutter:"10"},{default:g((function(){return[p(se,{span:"6",style:{display:"flex","align-items":"center","justify-content":"center"}},{default:g((function(){return[b("img",{src:e.avatar,alt:""},null,8,ne)]})),_:2},1024),p(se,{span:"12"},{default:g((function(){return[b("div",ae,[b("span",re,h(e.username),1),b("span",oe,[1===e.online?(f(),_(pe,{key:0,type:"success"},{default:g((function(){return[k("online")]})),_:1})):S("",!0),0===e.online?(f(),_(pe,{key:1,type:"danger"},{default:g((function(){return[k("offline")]})),_:1})):S("",!0),2===e.online?(f(),_(pe,{key:2,type:"warning"},{default:g((function(){return[k("busy")]})),_:1})):S("",!0)]),e.number===C.value.owner?(f(),v("span",le,[p(pe,{type:"success"},{default:g((function(){return[k("owner")]})),_:1})])):S("",!0)])]})),_:2},1024)]})),_:2},1024)]})),_:2},1024)})),128))]})),_:1},8,["loading","finished"])]})),_:1},8,["show"]),p(Ce,{show:je.value,"onUpdate:show":t[9]||(t[9]=function(e){return je.value=e}),position:"bottom",style:{height:"35%"}},{default:g((function(){return[ue,p(Ie,{onSubmit:we},{default:g((function(){return[p(j,{name:"uploader",label:"avatar"},{input:g((function(){return[p(Me,{modelValue:xe.value,"onUpdate:modelValue":t[7]||(t[7]=function(e){return xe.value=e}),"max-size":_e,"after-read":Fe,"before-read":ke,reupload:"","max-count":"1"},null,8,["modelValue"])]})),_:1}),b("div",ie,[p(Ue,{round:"",block:"",type:"primary","native-type":"submit",onClick:t[8]||(t[8]=function(e){return ge()})},{default:g((function(){return[k(" Submit ")]})),_:1})])]})),_:1})]})),_:1},8,["show"])],64)}}};t("default",a(ce,[["__scopeId","data-v-bfc950b6"]]))}}}))}();
