import{_ as _e,u as ce,r as v,h as fe,f as me,i as d,o as i,q as k,w as t,k as e,a as s,B as z,c as $,y as B,F as E,e as r,C as x,A as I,z as ge,t as T,x as A,p as he,d as ye}from"./index-1aea0b7d.js";import{f as j}from"./friend-146d61d7.js";import{g as w}from"./group-83d1f4e6.js";const C=F=>(he("data-v-1937614f"),F=F(),ye(),F),ke={class:"info-content"},be={class:"info-content"},xe={class:"info-content"},we={class:"info-content"},Ce=C(()=>s("div",{style:{color:"#FFFFFF",margin:"30px 20px"}},"Friend",-1)),Fe={class:"info-content"},Ge=["src"],$e=["onClick"],De={class:"text"},Se=C(()=>s("div",{style:{color:"#FFFFFF",margin:"20px"}},"Group chat",-1)),Ve={class:"info-content"},Ue=["src"],ze=["onClick"],Ae=C(()=>s("h4",{style:{"text-align":"center",padding:"10px"}},"Create/modify group chats",-1)),Me={style:{margin:"16px"}},Ne=C(()=>s("h4",{style:{"text-align":"center",padding:"10px"}},"Details",-1)),Pe={style:{margin:"16px"}},Be={style:{margin:"16px"}},Ee=C(()=>s("h4",{style:{"text-align":"center",padding:"10px"}},"Details",-1)),Ie={style:{margin:"16px"}},Te={key:0},je={style:{margin:"16px"}},Re={style:{margin:"16px"}},qe={key:1,style:{margin:"16px"}},Je={__name:"index",setup(F){const f=ce();v();const M=v([]),N=v([]),D=v(),_=v(),R=()=>{f.push("/index/".concat(D.value.id))},q=()=>{f.push("/group/".concat(_.value.id))},J=()=>{f.push("/add")},L=()=>{f.push("/addGroup")},O=()=>{f.push("/newFriend")},H=()=>{j.DeleteFriend({id:D.value.id}).then(a=>{a.code===200&&(x(a.msg),m(),G.value=!1)})},K=()=>{w.DeleteMyGroup({id:_.value.id}).then(a=>{a.code===200&&(x(a.msg),m(),b.value=!1)})},Q=()=>{w.LeaveGroup({id:_.value.id}).then(a=>{a.code===200&&(x(a.msg),m(),b.value=!1)})},W=()=>{l.value.name=_.value.name,l.value.avatar=[{url:_.value.avatar}],l.value.id=_.value.id,g.value=!0},m=()=>{j.GetFriend({}).then(a=>{a.code===200&&(M.value=a.data.friends)}),w.GetMyJoinGroup({}).then(a=>{a.code===200&&(N.value=a.data.groups)})};fe(()=>{m()});const g=v(!1),X=()=>{g.value=!0,l.value.name="",l.value.avatar=[]},G=v(!1),Y=a=>{G.value=!0,D.value=a},b=v(!1),Z=a=>{b.value=!0,_.value=a},l=v({name:"",avatar:[]}),ee=a=>{console.log("submit",a)},te=a=>{const n=a.type==="image/jpeg"?512e3:1024e3;return a.size>=n},ae=a=>/(jpg|jpeg|png|JPG|PNG)/i.test(a.type)?!0:(I("Please upload images in the correct format"),!1),S=me(),ne=a=>{a.status="uploading",a.message="上传中...";let n=new FormData;n.append("file",a.file),ge({url:window.location.origin+"/api/file/avatar/group",method:"POST",data:n,headers:{"content-type":"multipart/form-data",Authorization:"bearer "+S.token().value}}).then(p=>{p.data.code===200&&(a.status="done",I(p.data.msg),l.value.avatar=[{url:p.data.data}])})},oe=()=>{l.value.id?w.UpdateMyGroup({name:l.value.name,avatar:l.value.avatar,id:l.value.id}).then(a=>{a.code===200&&(g.value=!1,x(a.msg),m())}):w.AddMyGroup({name:l.value.name,avatar:l.value.avatar}).then(a=>{a.code===200&&(g.value=!1,x(a.msg),m())})};return(a,n)=>{const p=d("van-icon"),se=d("van-nav-bar"),le=d("el-header"),u=d("van-col"),h=d("van-row"),y=d("van-cell"),de=d("van-list"),V=d("van-tag"),ue=d("el-main"),P=d("van-field"),ie=d("van-uploader"),c=d("van-button"),re=d("van-form"),U=d("van-popup"),pe=d("el-container");return i(),k(pe,{style:{"font-size":"large"}},{default:t(()=>[e(le,null,{default:t(()=>[e(se,{title:"Address book"},{right:t(()=>[e(p,{name:"add-o",size:"20","is-link":"",onClick:X})]),_:1})]),_:1}),e(ue,null,{default:t(()=>[e(de,null,{default:t(()=>[e(y,null,{default:t(()=>[e(h,{gutter:"10"},{default:t(()=>[e(u,{span:"2"},{default:t(()=>[s("div",ke,[e(p,{name:"add-o"})])]),_:1}),e(u,{span:"22"},{default:t(()=>[s("span",{onClick:n[0]||(n[0]=o=>J()),style:{cursor:"pointer"}},"Add friends")]),_:1})]),_:1})]),_:1}),e(y,null,{default:t(()=>[e(h,{gutter:"10"},{default:t(()=>[e(u,{span:"2"},{default:t(()=>[s("div",be,[e(p,{name:"add-o"})])]),_:1}),e(u,{span:"22"},{default:t(()=>[s("span",{onClick:n[1]||(n[1]=o=>L()),style:{cursor:"pointer"}},"Add a group chat")]),_:1})]),_:1})]),_:1}),e(y,null,{default:t(()=>[e(h,{gutter:"10"},{default:t(()=>[e(u,{span:"2"},{default:t(()=>[s("div",xe,[e(p,{name:"add-o"})])]),_:1}),e(u,{span:"22"},{default:t(()=>[s("span",{onClick:n[2]||(n[2]=o=>O()),style:{cursor:"pointer"}},"New friend")]),_:1})]),_:1})]),_:1}),e(y,null,{default:t(()=>[e(h,{gutter:"10"},{default:t(()=>[e(u,{span:"2"},{default:t(()=>[s("div",we,[e(p,{name:"add-o"})])]),_:1}),e(u,{span:"22"},{default:t(()=>[s("span",{onClick:n[3]||(n[3]=o=>z(f).push("/index/".concat(z(S).user().value.id))),style:{cursor:"pointer"}},"oneself")]),_:1})]),_:1})]),_:1})]),_:1}),Ce,(i(!0),$(E,null,B(M.value,o=>(i(),k(y,null,{default:t(()=>[e(h,{gutter:"10"},{default:t(()=>[e(u,{span:"2"},{default:t(()=>[s("div",Fe,[s("img",{src:o.avatar,alt:"",style:{width:"100%",height:"100%"}},null,8,Ge)])]),_:2},1024),e(u,{span:"16"},{default:t(()=>[s("span",{style:{cursor:"pointer"},onClick:ve=>Y(o)},T(o.username),9,$e)]),_:2},1024),e(u,{span:"6"},{default:t(()=>[s("span",De,[o.online===1?(i(),k(V,{key:0,type:"success"},{default:t(()=>[r("online")]),_:1})):A("",!0),o.online===0?(i(),k(V,{key:1,type:"danger"},{default:t(()=>[r("offline")]),_:1})):A("",!0),o.online===2?(i(),k(V,{key:2,type:"warning"},{default:t(()=>[r("busy")]),_:1})):A("",!0)])]),_:2},1024)]),_:2},1024)]),_:2},1024))),256)),Se,(i(!0),$(E,null,B(N.value,o=>(i(),k(y,null,{default:t(()=>[e(h,{gutter:"10"},{default:t(()=>[e(u,{span:"2"},{default:t(()=>[s("div",Ve,[s("img",{src:o.avatar,alt:"",style:{width:"100%",height:"100%"}},null,8,Ue)])]),_:2},1024),e(u,{span:"20"},{default:t(()=>[s("span",{style:{cursor:"pointer"},onClick:ve=>Z(o)},T(o.name),9,ze)]),_:2},1024)]),_:2},1024)]),_:2},1024))),256))]),_:1}),e(U,{show:g.value,"onUpdate:show":n[7]||(n[7]=o=>g.value=o),position:"bottom",style:{height:"35%"}},{default:t(()=>[Ae,e(re,{onSubmit:ee},{default:t(()=>[e(P,{modelValue:l.value.name,"onUpdate:modelValue":n[4]||(n[4]=o=>l.value.name=o),name:"name",label:"name",placeholder:"name",rules:[{required:!0,message:"Please fill in the name"}]},null,8,["modelValue"]),e(P,{name:"uploader",label:"avatar"},{input:t(()=>[e(ie,{modelValue:l.value.avatar,"onUpdate:modelValue":n[5]||(n[5]=o=>l.value.avatar=o),"max-size":te,"after-read":ne,"before-read":ae,reupload:"","max-count":"1"},null,8,["modelValue"])]),_:1}),s("div",Me,[e(c,{round:"",block:"",type:"primary","native-type":"submit",onClick:n[6]||(n[6]=o=>oe())},{default:t(()=>[r(" Submit ")]),_:1})])]),_:1})]),_:1},8,["show"]),e(U,{show:G.value,"onUpdate:show":n[10]||(n[10]=o=>G.value=o),position:"bottom",style:{height:"35%"}},{default:t(()=>[Ne,s("div",Pe,[e(c,{round:"",block:"",type:"primary","native-type":"submit",onClick:n[8]||(n[8]=o=>R())},{default:t(()=>[r(" Direct Message ")]),_:1})]),s("div",Be,[e(c,{round:"",block:"",type:"danger","native-type":"submit",onClick:n[9]||(n[9]=o=>H())},{default:t(()=>[r(" Delete ")]),_:1})])]),_:1},8,["show"]),e(U,{show:b.value,"onUpdate:show":n[15]||(n[15]=o=>b.value=o),position:"bottom",style:{height:"35%"}},{default:t(()=>[Ee,s("div",Ie,[e(c,{round:"",block:"",type:"primary","native-type":"submit",onClick:n[11]||(n[11]=o=>q())},{default:t(()=>[r(" Enter a group chat ")]),_:1})]),_.value.owner===z(S).user().value.number?(i(),$("div",Te,[s("div",je,[e(c,{round:"",block:"",type:"danger","native-type":"submit",onClick:n[12]||(n[12]=o=>K())},{default:t(()=>[r(" Disband a group chat ")]),_:1})]),s("div",Re,[e(c,{round:"",block:"",type:"danger","native-type":"submit",onClick:n[13]||(n[13]=o=>W())},{default:t(()=>[r(" Modify group chat ")]),_:1})])])):(i(),$("div",qe,[e(c,{round:"",block:"",type:"danger","native-type":"submit",onClick:n[14]||(n[14]=o=>Q())},{default:t(()=>[r(" Exit a group chat ")]),_:1})]))]),_:1},8,["show"])]),_:1})}}},Ke=_e(Je,[["__scopeId","data-v-1937614f"]]);export{Ke as default};
