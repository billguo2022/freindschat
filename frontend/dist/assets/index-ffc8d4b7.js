import{_ as ve,r,M as me,f as ge,u as fe,m as he,h as ye,i as l,j as xe,o as u,c as d,k as a,w as n,F as D,a as s,t as m,y as G,l as be,q as y,e as x,z as O,A as ke,C as we,B as q,x as p,p as Fe,d as Se}from"./index-1aea0b7d.js";import{g as ze}from"./group-83d1f4e6.js";const E=b=>(Fe("data-v-bfc950b6"),b=b(),Se(),b),Ce={class:"avatar-content"},Me=["src"],Re={style:{display:"flex","align-items":"center",width:"100%","justify-content":"center"}},je={class:"text",style:{"text-align":"center"}},Ve={class:"chat-time"},Te={key:0,class:"other-content"},Be={style:{display:"flex","flex-direction":"column"}},De={style:{color:"#FFFFFF"}},Pe=["src"],Ie={key:0,class:"my-talk-bubble"},Ne={class:"talktext"},Ue=["src"],$e={key:2,controls:""},Ae=["src"],Ge={key:1,class:"my-content"},Oe={key:0,class:"my-talk-bubble"},qe={class:"talktext"},Ee=["src"],Je={key:2,controls:""},Le=["src"],Ye={style:{display:"flex","flex-direction":"column"}},He={style:{color:"#FFFFFF"}},Ke=["src"],Qe=E(()=>s("h4",{style:{"text-align":"center",padding:"10px"}},"Group chat personnel",-1)),We=["src"],Xe={style:{height:"100%",display:"flex","justify-content":"flex-start","align-items":"flex-start"}},Ze={class:"text",style:{"margin-right":"10px"}},et={class:"text",style:{"margin-right":"10px"}},tt={key:0,class:"text",style:{"margin-right":"10px"}},ot=E(()=>s("h4",{style:{"text-align":"center",padding:"10px"}},"Send pictures",-1)),at={style:{margin:"16px"}},nt={__name:"index",setup(b){r(null);const{socket:S}=me.getInstance(),_=ge();fe();const g=he(),f=r({}),h=r(_.group(g.params.id).value);r(null);const c=r({content:"",group_id:g.params.id,image_url:"",audio_url:"",token:_.token().value}),v=r(null),z=r([]),P=()=>{navigator.mediaDevices.getUserMedia({audio:!0}).then(o=>{v.value=new MediaRecorder(o),z.value=[],v.value.ondataavailable=t=>{t.data.size>0&&z.value.push(t.data)},v.value.start()}).catch(o=>{console.error("Recording failed:",o)})},C=()=>{v.value&&v.value.state!=="inactive"&&(v.value.stop(),v.value.onstop=()=>{const o=new Blob(z.value,{type:"audio/mp3"});J(o)})},J=o=>{const t=new FormData;t.append("audio",o,"audio.mp3"),O(window.location.origin+"/api/file/audio",{method:"POST",data:t,headers:{Authorization:"bearer "+_.token().value}}).then(i=>{i.data.code===200&&(console.log(i.data.data),c.value.audio_url=i.data.data,M())}).catch(i=>{console.error("发送音频失败:",i)})};ye(()=>{ze.GetGroupById({id:g.params.id}).then(o=>{o.code===200&&(f.value=o.data)}),_.joined_group(g.params.id),S.on("joined_group_message",o=>{console.log("joined_group_message"),h.value=o.message,_.group(g.params.id).value=o.message})});const M=()=>{c.value.image_url===""&&c.value.audio_url===""&&c.value.content===""||(S.emit("groupChat",c.value),c.value.content="",c.value.image_url="",c.value.audio_url="",w.value=!1,k.value=[])};S.on("group_message",o=>{console.log(o);let t=[...h.value,o.message];h.value=t,_.group(g.params.id).value=h.value});const I=r([]),R=r(!1),N=r(!1);r(!1);const j=r(!1),L=()=>{j.value=!0,I.value=f.value.members,R.value=!0,N.value=!0},k=r([]),Y=o=>{const t=o.type==="image/jpeg"?512e3:1024e3;return o.size>=t},H=o=>/(jpg|jpeg|png|JPG|PNG)/i.test(o.type)?!0:(ke("Please upload images in the correct format"),!1),K=o=>{console.log("submit",o)},Q=o=>{o.status="uploading",o.message="上传中...";let t=new FormData;t.append("file",o.file),O({url:window.location.origin+"/api/file/avatar/group",method:"POST",data:t,headers:{"content-type":"multipart/form-data",Authorization:"bearer "+_.token().value}}).then(i=>{i.data.code===200&&(o.status="done",we(i.data.msg),c.value.image_url=i.data.data,k.value=[{url:i.data.data}])})},w=r(!1),W=()=>{w.value=!0};return(o,t)=>{const i=l("van-icon"),V=l("el-col"),X=l("el-row"),Z=l("el-header"),ee=l("el-main"),te=l("Microphone"),T=l("el-icon"),oe=l("Picture"),ae=l("Right"),U=l("van-field"),ne=l("van-cell-group"),se=l("el-footer"),le=l("el-container"),$=l("van-col"),F=l("van-tag"),ue=l("van-row"),re=l("van-cell"),ie=l("van-list"),A=l("van-popup"),de=l("van-uploader"),ce=l("van-button"),_e=l("van-form"),pe=xe("autofocus");return u(),d(D,null,[a(le,null,{default:n(()=>[a(Z,null,{default:n(()=>[a(X,{gutter:12},{default:n(()=>[a(V,{span:4},{default:n(()=>[s("div",{class:"left-back",onClick:t[0]||(t[0]=e=>o.$router.back())},[a(i,{name:"arrow-left",size:"20"})])]),_:1}),a(V,{span:16},{default:n(()=>[s("div",Ce,[s("img",{src:f.value.avatar,alt:""},null,8,Me),s("div",Re,[s("span",je,m(f.value.name),1)])])]),_:1}),a(V,{span:4},{default:n(()=>[s("div",{class:"left-back",onClick:t[1]||(t[1]=e=>L())},[a(i,{name:"friends-o",size:"20"})])]),_:1})]),_:1})]),_:1}),a(ee,null,{default:n(()=>[(u(!0),d(D,null,G(h.value,(e,B)=>(u(),d("div",{key:B},[s("div",Ve,m(e.created_at),1),e.sender.id!==q(_).user().value.id?(u(),d("div",Te,[s("div",Be,[s("span",De,m(e.sender.username),1),s("img",{src:e.sender.avatar,alt:"",style:{width:"50px",height:"50px","margin-left":"10px"}},null,8,Pe)]),e.content?(u(),d("div",Ie,[s("div",Ne,[s("p",null,m(e.content),1)])])):e.image_url?(u(),d("img",{key:1,src:e.image_url,alt:"",style:{"border-radius":"0"}},null,8,Ue)):e.audio_url?(u(),d("audio",$e,[s("source",{src:e.audio_url,type:"audio/mp3"},null,8,Ae)])):p("",!0)])):p("",!0),e.sender.id===q(_).user().value.id?(u(),d("div",Ge,[e.content?(u(),d("div",Oe,[s("div",qe,[s("p",null,m(e.content),1)])])):e.image_url?(u(),d("img",{key:1,src:e.image_url,alt:"",style:{"border-radius":"0"}},null,8,Ee)):e.audio_url?(u(),d("audio",Je,[s("source",{src:e.audio_url,type:"audio/mp3"},null,8,Le)])):p("",!0),s("div",Ye,[s("span",He,m(e.sender.username),1),s("img",{src:e.sender.avatar,alt:"",style:{width:"50px",height:"50px","margin-left":"10px"}},null,8,Ke)])])):p("",!0)]))),128))]),_:1}),a(se,null,{default:n(()=>[a(ne,{inset:""},{default:n(()=>[be((u(),y(U,{modelValue:c.value.content,"onUpdate:modelValue":t[4]||(t[4]=e=>c.value.content=e),placeholder:"Send Your Message"},{"left-icon":n(()=>[a(T,{size:"25",color:"#FFFFFF",onMousedown:P,onMouseup:C,onTouchstart:P,onTouchmove:C,onTouchend:C},{default:n(()=>[a(te)]),_:1}),a(T,{size:"25",color:"#FFFFFF",onClick:t[2]||(t[2]=e=>W()),style:{"margin-left":"20px"}},{default:n(()=>[a(oe)]),_:1})]),"right-icon":n(()=>[a(T,{size:"25",color:"#FFFFFF",onClick:t[3]||(t[3]=e=>M())},{default:n(()=>[a(ae)]),_:1})]),_:1},8,["modelValue"])),[[pe]])]),_:1})]),_:1})]),_:1}),a(A,{show:j.value,"onUpdate:show":t[6]||(t[6]=e=>j.value=e),position:"bottom",style:{height:"50%"}},{default:n(()=>[Qe,a(ie,{loading:R.value,"onUpdate:loading":t[5]||(t[5]=e=>R.value=e),finished:N.value,"finished-text":"No more..."},{default:n(()=>[(u(!0),d(D,null,G(I.value,(e,B)=>(u(),y(re,{key:B},{default:n(()=>[a(ue,{gutter:"10"},{default:n(()=>[a($,{span:"6",style:{display:"flex","align-items":"center","justify-content":"center"}},{default:n(()=>[s("img",{src:e.avatar,alt:""},null,8,We)]),_:2},1024),a($,{span:"12"},{default:n(()=>[s("div",Xe,[s("span",Ze,m(e.username),1),s("span",et,[e.online===1?(u(),y(F,{key:0,type:"success"},{default:n(()=>[x("online")]),_:1})):p("",!0),e.online===0?(u(),y(F,{key:1,type:"danger"},{default:n(()=>[x("offline")]),_:1})):p("",!0),e.online===2?(u(),y(F,{key:2,type:"warning"},{default:n(()=>[x("busy")]),_:1})):p("",!0)]),e.number===f.value.owner?(u(),d("span",tt,[a(F,{type:"success"},{default:n(()=>[x("owner")]),_:1})])):p("",!0)])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["loading","finished"])]),_:1},8,["show"]),a(A,{show:w.value,"onUpdate:show":t[9]||(t[9]=e=>w.value=e),position:"bottom",style:{height:"35%"}},{default:n(()=>[ot,a(_e,{onSubmit:K},{default:n(()=>[a(U,{name:"uploader",label:"avatar"},{input:n(()=>[a(de,{modelValue:k.value,"onUpdate:modelValue":t[7]||(t[7]=e=>k.value=e),"max-size":Y,"after-read":Q,"before-read":H,reupload:"","max-count":"1"},null,8,["modelValue"])]),_:1}),s("div",at,[a(ce,{round:"",block:"",type:"primary","native-type":"submit",onClick:t[8]||(t[8]=e=>M())},{default:n(()=>[x(" Submit ")]),_:1})])]),_:1})]),_:1},8,["show"])],64)}}},ut=ve(nt,[["__scopeId","data-v-bfc950b6"]]);export{ut as default};
